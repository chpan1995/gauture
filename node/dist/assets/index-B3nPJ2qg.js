import{u as _}from"./index-BYMrysU6.js";import{d as P,r as u,x as G,c as J,e as a,w as t,f as i,A as w,u as n,i as f,b as x,E as z,o as K,B as L}from"./index-C7oGZG6Y.js";import"./request-Bboo2TiE.js";const Q={style:{flex:"auto"}},h=P({__name:"index",setup(W){let v=u(!1),c=u(),o=u({username:"",nickname:"",password:""});const q=u({username:[{required:!0,message:"请输入用户名称",trigger:"blur"},{min:2,max:10,message:"长度范围2~10",trigger:"blur"}],nickname:[{required:!0,message:"请输入用户名字",trigger:"blur"},{min:2,max:10,message:"长度范围2~10",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:2,max:10,message:"长度范围2~10",trigger:"blur"}]});let s=u(!1),m=u(1),d=u(5),U=u(0),V=u([]);const E=async()=>{v.value=!1,Object.assign(o.value,{username:"",nickname:"",password:""}),L(()=>{c.value&&c.value.clearValidate()}),s.value=!s.value},N=()=>{s.value=!1},A=async()=>{s.value=!1,v.value?await _.reqUpdateUser(o.value):(await _.reqAddUser(o.value)).code!==200&&z({type:"error",message:"添加用户失败"}),await b()},B=async r=>{(await _.reqDeleteUser({id:r})).code!==200&&z({type:"error",message:"删除用户失败"}),await b()},C=(r=1)=>{m.value=r,b()},S=()=>{C()},j=r=>{c.value&&c.value.clearValidate(),v.value=!0,Object.assign(o.value,{username:r.username,nickname:r.nickname,password:r.password,id:r.id}),s.value=!s.value},b=async()=>{let r=await _.reqUsercount(),e=await D();(e.code=200)&&(V.value=e.data),U.value=r.count},D=async()=>await _.reqUserInfo((m.value-1)*d.value,d.value);return G(async()=>{await b()}),(r,e)=>{const g=i("el-button"),p=i("el-table-column"),F=i("el-popconfirm"),R=i("el-table"),I=i("el-pagination"),O=i("el-card"),y=i("el-input"),k=i("el-form-item"),T=i("el-form"),H=i("el-drawer");return K(),J("div",null,[a(g,{type:"primary",size:"default",onClick:E},{default:t(()=>e[6]||(e[6]=[f("添加用户")])),_:1}),a(O,{style:{"margin-top":"20px"}},{default:t(()=>[a(R,{border:"",data:n(V),style:{"margin-bottom":"20px"}},{default:t(()=>[a(p,{label:"#",align:"center",type:"index"}),a(p,{label:"用户名称",align:"center",prop:"username"}),a(p,{label:"用户名字",align:"center",prop:"nickname"}),a(p,{label:"用户角色",align:"center"},{default:t(()=>e[7]||(e[7]=[f(" 质检员 ")])),_:1}),a(p,{label:"创建时间",align:"center",prop:"createtime"}),a(p,{label:"操作",align:"center"},{default:t(({row:l,index:X})=>[a(g,{type:"primary",size:"small",icon:"Edit",onClick:M=>j(l)},{default:t(()=>e[8]||(e[8]=[f("编辑")])),_:2},1032,["onClick"]),a(F,{title:`你确定要删除${l.username}?`,width:"260px",onConfirm:M=>B(l.id)},{reference:t(()=>[a(g,{type:"primary",size:"small",icon:"Delete"},{default:t(()=>e[9]||(e[9]=[f("删除")])),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),a(I,{"current-page":n(m),"onUpdate:currentPage":e[0]||(e[0]=l=>w(m)?m.value=l:m=l),"page-size":n(d),"onUpdate:pageSize":e[1]||(e[1]=l=>w(d)?d.value=l:d=l),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper,->,sizes,total",total:n(U),onCurrentChange:C,onSizeChange:S},null,8,["current-page","page-size","total"])]),_:1}),a(H,{modelValue:n(s),"onUpdate:modelValue":e[5]||(e[5]=l=>w(s)?s.value=l:s=l),direction:"rtl"},{header:t(()=>e[10]||(e[10]=[x("h4",null,"添加用户",-1)])),default:t(()=>[x("div",null,[a(T,{ref_key:"ruleFormRef",ref:c,"label-width":"auto",model:n(o),rules:q.value},{default:t(()=>[a(k,{label:"用户名称",prop:"username"},{default:t(()=>[a(y,{modelValue:n(o).username,"onUpdate:modelValue":e[2]||(e[2]=l=>n(o).username=l)},null,8,["modelValue"])]),_:1}),a(k,{label:"用户名字",prop:"nickname"},{default:t(()=>[a(y,{modelValue:n(o).nickname,"onUpdate:modelValue":e[3]||(e[3]=l=>n(o).nickname=l)},null,8,["modelValue"])]),_:1}),a(k,{label:n(v)?"新密码":"用户密码",prop:"password"},{default:t(()=>[a(y,{modelValue:n(o).password,"onUpdate:modelValue":e[4]||(e[4]=l=>n(o).password=l),type:"password"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])])]),footer:t(()=>[x("div",Q,[a(g,{onClick:N},{default:t(()=>e[11]||(e[11]=[f("取消")])),_:1}),a(g,{type:"primary",onClick:A},{default:t(()=>e[12]||(e[12]=[f("确认")])),_:1})])]),_:1},8,["modelValue"])])}}});export{h as default};
